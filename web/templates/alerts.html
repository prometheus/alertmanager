{{define "alertsTabClass"}}active{{end}}

{{define "head"}}
    <script src="{{ pathPrefix }}static/js/alerts.js"></script>
{{end}}

{{define "content"}}
    <h2>Alerts</h2>
    <table class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <th>Alert</th>
          <th>Labels</th>
          <th>Active Since</th>
          <th>Last Refreshed</th>
          <th>Generated By</th>
          <th>Alerting Rule</th>
          <th>Silenced</th>
        </tr>
      </thead>
      <tbody>
        {{$silenceForAlert := .SilenceForAlert}}
        {{range .AlertAggregates}}
          <tr>
            <td>
              <span class="label label-important">{{index .Alert.Name}}</span>
              <form class="add_silence_form">
                <input type="hidden" name="label[]" value="alertname">
                <input type="hidden" name="value[]" value="{{.Alert.Name}}">
                <a href="#edit_silence_modal" role="button" class="btn btn-mini add_silence_btn" data-toggle="modal">Silence Alert</a>
              </form>
            </td>
            <td>
              {{range $label, $value := .Alert.Labels}}
                {{if not (eq $label "alertname")}}
                  <span class="label label-info">{{$label}}="{{$value}}"</span>
                {{end}}
              {{end}}
              <form class="add_silence_form">
                {{range $label, $value := .Alert.Labels}}
                  <input type="hidden" name="label[]" value="{{$label}}">
                  <input type="hidden" name="value[]" value="{{$value}}">
                {{end}}
                <a href="#edit_silence_modal" role="button" class="btn btn-mini add_silence_btn" data-toggle="modal">Silence Instance</a>
              </form>
            </td>
            <td>{{timeSince .Created}} ago</td>
            <td>{{timeSince .LastRefreshed}} ago</td>
            <td>
              {{if .Alert.Payload.GeneratorURL}}
                <a href="{{.Alert.Payload.GeneratorURL}}">{{(truncate .Alert.Payload.GeneratorURL 40)}}</a>
              {{end}}
            </td>
            <td>{{.Alert.Payload.AlertingRule}}</td>
            <td>
              {{$silence := call $silenceForAlert .Alert}}
              {{if $silence}}
                by <a href="#" class="silence_link">silence {{$silence.ID}}</a>
              {{else}}
                not silenced
              {{end}}
            </td>
          </tr>
        {{end}}
      </tbody>
    </table>
    {{template "editSilenceModal" .}}
{{end}}
